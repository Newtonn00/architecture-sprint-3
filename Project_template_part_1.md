# Задание 1. Анализ и планирование

### 1. Описание функциональности монолитного приложения

**Управление отоплением:**

- Пользователи могут:
    удаленно включать и отключать отопление в своих домах
    устанавливать целевую температуру для отопительного устройства 
    Для этого используются мобильное приложение и/или веб-приложение (личный профиль пользователя) 

- Система поддерживает:
    Синхронный интерфейс REST API:
        POST-запросы от внешних клиентов для изменения состояния объектов: включение, выключение, установка целевой температуры, установка текущей темепературы для устройства
        GET-запросы от внешних клиентов для получения всех свойствв отопительного устройства (включен/выключен, текущая температура, целевая температура)
        PUT-запрос для обновления всех свойств объекта отопительного устройства
    Логирование всех обращений через API 
    Сохранение изменений в БД

**Мониторинг температуры:**

- Пользователи могут запросить текущую температуру. Запрос производится относительно отопительных устройств
    Для этого используются мобильное приложение и/или веб-приложение (личный профиль пользователя) 
- Система поддерживает:
     Синхронный интерфейс REST API:
         GET-запросы от внешних клиентов для получения информации о текущей температуре по данным объекта отопительного устройства 
    Логирование обращений через API
    Сохранение изменений в БД    

### 2. Анализ архитектуры монолитного приложения


- Язык программирования: Java
- База данных: PostgreSQL 15.5.2
- Архитектура: монолитная - вся бизнес-логика содержится в одном приложении, которое тестируется и разворачивается в едином процессе
- Структура проекта:
    Проект организован в соответствии со стандартной структурой Maven/Gradle проекта
    - `controller` - контроллеры для обработки HTTP-запросов.
    - `service` - сервисы для бизнес-логики.
    - `repository` - репозитории для доступа к базе данных.
    - `entity` - сущности JPA.
    - `dto` - объекты передачи данных (DTO).
- Интеграционные интерфейсы:
    Приложение поддерживает синхронное взаимодействие через REST API
    Объявлен 1 эндпоинт
- Масштабируемость
    Ограничена из-за монолиного характера приложения
    Возможно только вертикальное масштабирование за счет наращивания ресурсов
- Надежность
    Приложение и БД развернуты в разных контейнерах
    Репликации не предусмотрены
- CI/CD
    Пайплайн реализован с помощью Github Actions
    Предусмотрены этапы сбоки и тестирования
    Так как приложение монолитное, то всегда собирается и тестируется весь программный код. При установке новой версии останавливается всё приложение 


### 3. Определение доменов и границы контекстов

#### Основные домены:

1. Домен Управление умным домом
    Контекст Локаций
        Управление локациями, как логическими единицами
	    Привязка устройств и сценариев к конкретным комнатам
    Контекст Действий
        Управление состоянием устройств (включить/выключить свет, открыть/закрыть ворота и т.д.)
	    Настройка и обновление параметров устройств
    Контекст Сценариев автоматизации
        Создание и настройка сценариев (например, “включить свет при открытии ворот”)
        Управление триггерами и последовательностями действий
        Хранение и выполнение сценариев
2. Домен Управление оборудованием и устройствами
    Контекст Устройства и оборудования
        Регистрация, статусы и прочие свойства
        Перемещение между складами, списания и поступления
    Контекст Эксплуатация устройств
        Настройка и обновление
        Ремонт и замена устройства
    Контекст Мониторинг и диагностика
        Сбор данных о состоянии устройств
        Диагностика проблем с подключением
3. Домен Управление пользователями
    Контекст Пользовательский аккаунт
        Управление профилем пользователя
        Просмотр подключённых устройств и управление ими
        Настройка уведомлений
        Настройка способо оплаты
    Контекст Аутентификации и авторизации
        Регистрация новых пользователей
        Вход в систему, валидация токенов и т.п.
        Поддержка ролей
    Контекст Платежи
        Оплата через различные агрегаторы, банки и т.д.
        Автоматические списания
    Контекст Уведомления
        Отправка уведомлений о событиях (например, изменение температуры, завершение сценария)
        Управление каналами доставки (push, email, SMS)
    Контекст Отчетность
        Отчетность по списаниям
        Дашборды по работе устройств
4. Домен Управление продажами
    Контекст Тарифы
        Модели Saaa подписки
        Специальные цены
    Контекст Маркетинг
        Сегментация клиентов
        Маркетинговые кампаниия
    Контекст Продажи
        Продажи комлпектов
        Биллинг за услуги
    Контекст Платежи
        Интеграции с агрегаторами
        Платежные транзакциии
        Претензии и возвраты

#### Вспомогательные домены:

1. Домен Управление платформой
    Контекст Инфраструктура
        Управление микросервисами и конфигурацией системы
        Масштабируемость и отказоустойчивость
    Контекст Интеграция
        Подключение внешних систем и устройств
        Интерфейсы для работы со сторонними партнёрами
    Контекст Информационная безопасность
        Шифрование данных, управление токенами
        Логи безопасности и управление доступом    


### **4. Проблемы монолитного решения**

- отсутствие возможности масштабировать отдельные сегменты решения
- низкая надежность за счет высокой связанности кода внутри монолитного приложения - активная разработка повлечет значительное количетво ошибок в различных частях системы
- длительная остановка обслуживания клиентов при установке новых версий
- низкий time-to-market за счет необходимости разработки в одних и тех же частях кода


### 5. Визуализация контекста системы — диаграмма С4

Контекстная диаграмма системы AS-IS состоит из 3-х блоков: Клиент компании, Система управления устройствами и внешняя платформа обмена данными с утройствами

[Контекстная диаграмма](diagrams/context/WarmHome_C4_Context.puml)

# Задание 2. Проектирование микросервисной архитектуры

В этом задании вам нужно предоставить только диаграммы в модели C4. Мы не просим вас отдельно описывать получившиеся микросервисы и то, как вы определили взаимодействия между компонентами To-Be системы. Если вы правильно подготовите диаграммы C4, они и так это покажут.

**Диаграмма контейнеров (Containers)**

[Контейнерная диаграмма](diagrams/container/WarmHome_C4_Container.puml)

**Диаграмма компонентов (Components)**
Для отрисовки Компонентной диаграммы выбран микросервис Order Service

[Компонентная диаграмма](diagrams/component/WarmHome_C4_Component_OrderService.puml)

**Диаграмма кода (Code)**
Для диаграммы Классов выбран компонент Order Processor. На диаграмме отражены основные классы компонента

[Диаграмма Классов](diagrams/er/Warmhome_C4_Code_OrderService_OrderProcessor.puml)

# Задание 3. Разработка ER-диаграммы

[ER-диаграмма](diagrams/сщву/WarmHome_ER_Diagram.puml)
